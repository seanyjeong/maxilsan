<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MaxFeed</title>
  <link href="https://cdn.jsdelivr.net/npm/water.css@2/out/light.min.css" rel="stylesheet">
  <style>
    .feed { border-bottom: 1px solid #ddd; padding: 15px 0; }
    .profile img { width: 40px; height: 40px; border-radius: 50%; margin-right: 10px; }
    .media img, video { max-height: 300px; width: 100%; object-fit: cover; border-radius: 8px; }
    button { margin-right: 5px; }
  </style>
</head>
<body>

<h2>ğŸ”¥ Max Feed ğŸ”¥</h2>

<!-- íšŒì›ê°€ì… -->
<section>
  <h3>íšŒì›ê°€ì…</h3>
  <input type="text" id="new_username" placeholder="ì•„ì´ë””">
  <input type="password" id="new_password" placeholder="ë¹„ë°€ë²ˆí˜¸">
  <input type="text" id="name" placeholder="ì´ë¦„">
  <input type="date" id="birth_date">
  <input type="text" id="phone" placeholder="ì „í™”ë²ˆí˜¸">
  <input type="text" id="school" placeholder="í•™êµ">
  <input type="text" id="grade" placeholder="í•™ë…„">
  <select id="gender">
    <option value="male">ë‚¨ì„±</option>
    <option value="female">ì—¬ì„±</option>
  </select>
  <label><input type="checkbox" id="consent"> ê°œì¸ì •ë³´ ì œê³µì— ë™ì˜í•©ë‹ˆë‹¤.</label><br>
  <button onclick="register()">ê°€ì…í•˜ê¸°</button>
</section>

<!-- ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ -->
<section>
  <h3>ë¡œê·¸ì¸</h3>
  <input type="text" id="username" placeholder="ì•„ì´ë””">
  <input type="password" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸">
  <button onclick="login()">ë¡œê·¸ì¸</button>
  <button onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
</section>

<!-- í”¼ë“œ ì˜¬ë¦¬ê¸° -->
<section>
  <h3>í”¼ë“œ ì˜¬ë¦¬ê¸°</h3>
  <textarea id="content" placeholder="ë‚´ìš©"></textarea><br>
  <input type="file" id="file">
  <button onclick="addFeed()">ì—…ë¡œë“œ</button>
</section>

<!-- í”¼ë“œ ë³´ê¸° -->
<section>
  <h3>í”¼ë“œ ëª©ë¡</h3>
  <button onclick="loadFeeds()">ì „ì²´ í”¼ë“œ</button>
  <button onclick="loadMyFeeds()">ë‚´ í”¼ë“œ</button>
  <div id="feeds"></div>
</section>

<script>
const api = 'https://supermax.kr/feed';


async function register() {
  const user = {
    username: document.getElementById('new_username').value,
    password: document.getElementById('new_password').value,
    name: document.getElementById('name').value,
    birth_date: document.getElementById('birth_date').value,
    phone: document.getElementById('phone').value,
    school: document.getElementById('school').value,
    grade: document.getElementById('grade').value,
    gender: document.getElementById('gender').value,
    consent: document.getElementById('consent').checked
  };

  const res = await fetch(`${api}/register`, {
    method: 'POST', headers: {'Content-Type':'application/json'},
    body: JSON.stringify(user)
  });

  if(res.ok) alert('ê°€ì… ì„±ê³µ!');
  else alert('ê°€ì… ì‹¤íŒ¨');
}

async function login() {
  const res = await fetch(`${api}/login`, {
    method: 'POST', headers: {'Content-Type':'application/json'},
    body: JSON.stringify({
      username: document.getElementById('username').value,
      password: document.getElementById('password').value
    })
  });

  const data = await res.json();
  if (res.ok) {
    localStorage.setItem('token', data.token);
    alert('ë¡œê·¸ì¸ ì„±ê³µ');
  } else alert('ë¡œê·¸ì¸ ì‹¤íŒ¨');
}

function logout(){ localStorage.removeItem('token'); alert('ë¡œê·¸ì•„ì›ƒë¨'); }

async function addFeed() {
  const formData = new FormData();
  formData.append('content', document.getElementById('content').value);
  formData.append('file', document.getElementById('file').files[0]);

  const res = await fetch(`${api}/add-feed`, {
    method:'POST',
    headers:{'Authorization':'Bearer '+localStorage.getItem('token')},
    body:formData
  });

  if(res.ok) alert('ì—…ë¡œë“œ ì™„ë£Œ');
  else alert('ì—…ë¡œë“œ ì‹¤íŒ¨');
}

async function loadFeeds(endpoint='/feeds') {
  const res = await fetch(`${api}${endpoint}`);
  const feeds = await res.json();
  const feedsDiv = document.getElementById('feeds'); feedsDiv.innerHTML='';

  feeds.forEach(feed=>{
    feedsDiv.innerHTML += `<div class="feed">
      <div class="profile">
        <img src="${feed.profile_image||'https://via.placeholder.com/40'}">
        <strong>${feed.username}</strong>
      </div>
      <p>${feed.content||''}</p>
      ${feed.media_url ? (feed.media_url.includes('.mp4')?`<video controls src="${feed.media_url}"></video>`:`<img src="${feed.media_url}">`) : ''}
      <button onclick="likeFeed(${feed.id})">ğŸ‘ì¢‹ì•„ìš”</button>
      <button onclick="commentFeed(${feed.id})">ğŸ’¬ëŒ“ê¸€</button>
    </div>`;
  });
}

function loadMyFeeds() { loadFeeds('/my-feeds'); }

async function likeFeed(feedId){ alert('ì¢‹ì•„ìš” ê¸°ëŠ¥ ì¤€ë¹„ ì¤‘'); }
async function commentFeed(feedId){ alert('ëŒ“ê¸€ ê¸°ëŠ¥ ì¤€ë¹„ ì¤‘'); }

loadFeeds();
</script>

</body>
</html>
