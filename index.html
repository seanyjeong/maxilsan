<!DOCTYPE html>
<html>
<head>
    <title>Login</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <style>
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 30%;
        }
        th.대학명, td.대학명 {
            min-width: 7em;
            text-align: center;
        }
        th.학과명, td.학과명 {
            min-width: 7em;
            text-align: center;
        }
        th.수능점수, td.수능점수 {
            min-width: 6em;
            text-align: center;
        }
        th.내신점수, td.내신점수 {
            min-width: 6em;
            text-align: center;
        }
        th, td {
            text-align: center;
        }
        input[type="text"] {
            width: 3em;
        }
        @media screen and (max-width: 600px) {
            table {
                width: 100%;
            }
        }
    </style>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    </style>
</head>
<body>
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <h2>로그인</h2>
            <label for="name">이름:</label><br>
            <input type="text" id="name" name="name"><br>
            <label for="code">식별코드:</label><br>
            <input type="text" id="code" name="code"><br>
            <button id="submitBtn">제출</button>
        </div>
    </div>

    <div id="userData" style="display:none;">
        <h2 id="userName"></h2>
        <div id="가군"><h3>가군</h3></div>
        <div id="나군"><h3>나군</h3></div>
        <div id="다군"><h3>다군</h3></div>
    </div>

    <script>
        function loadCsvData() {
            return fetch('https://raw.githubusercontent.com/seanyjeong/maxilsan/main/silgiall.csv')
                .then(response => response.text())
                .then(data => {
                    var rows = data.split('\n');
                    var result = {};
                    rows.forEach(function(row) {
                        var cells = row.split(',');
                        var 대학명 = cells[2];
                        var 학과명 = cells[3];
                        var 실기종목 = cells.slice(4, 10).filter(function(cell) { return cell !== ''; });
                        result[대학명 + 학과명] = 실기종목;
                    });
                    return result;
                })
                .catch(error => console.error('Error:', error));
        }

        $(document).ready(function(){
            $("#loginModal").show();

            $("#submitBtn").click(function(){
                var name = $("#name").val();
                var code = $("#code").val();

                $.ajax({
                    url: "https://script.google.com/macros/s/AKfycbyvIvMNE99a9dozw1oPZBo9UE8mLmD_5r5tlWpgQtLRfzxWcTjTwm9FqJkxVe_SaEMN/exec",
                    type: "post",
                    data: {name: name, code: code},
                    success: function(response) {
                        if(response != "failure") {
                            var data = JSON.parse(response);
                            $("#userName").html(name + "님의 지원정보");

                            var labels = ["대학명", "학과명", "수능점수", "내신점수"];
                            var groups = ["가군", "나군", "다군"];

                            loadCsvData().then(function(csvData) {
     groups.forEach(function(group) {
        // "대학명", "학과명", "수능점수", "내신점수"에 대한 테이블 생성
        var table1 = document.createElement('table');
        var thead1 = document.createElement('thead');
        var tbody1 = document.createElement('tbody');

        // "대학명", "학과명", "수능점수", "내신점수" 헤더 생성
        var tr = document.createElement('tr');
        labels.forEach(function(label) {
            var th = document.createElement('th');
            th.className = label;
            th.textContent = label;
            tr.appendChild(th);
        });
        thead1.appendChild(tr);

        // "대학명", "학과명", "수능점수", "내신점수" 데이터 생성
        var tr = document.createElement('tr');
        labels.forEach(function(label) {
            var td = document.createElement('td');
            td.className = label;
            td.textContent = data[group][label];
            tr.appendChild(td);
        });
        tbody1.appendChild(tr);

        // 생성된 헤더와 본문을 첫 번째 테이블에 추가
        table1.appendChild(thead1);
        table1.appendChild(tbody1);

        $("#" + group).append(table1);

        // "실기종목"에 대한 테이블 생성
        var table2 = document.createElement('table');
        var thead2 = document.createElement('thead');
        var tbody2 = document.createElement('tbody');

        // "실기종목" 헤더 생성
        var 실기종목 = csvData[data[group]["대학명"] + data[group]["학과명"]];
        var tr = document.createElement('tr');
        실기종목.forEach(function(종목) {
            if (종목.trim() !== '') {  // 실기종목이 공백이 아닌 경우에만 헤더를 생성
                var th = document.createElement('th');
                th.textContent = 종목;
                th.style.fontWeight = 'normal';  // 글자를 굵게 하지 않음
                tr.appendChild(th);
            }
        });
        thead2.appendChild(tr);

        // "실기종목" 입력칸 생성
        var tr = document.createElement('tr');
        실기종목.forEach(function(종목) {
            if (종목.trim() !== '') {  // 실기종목이 공백이 아닌 경우에만 입력칸을 생성
                var td = document.createElement('td');
                var input = document.createElement('input');
                input.type = 'text';
                td.appendChild(input);
                tr.appendChild(td);
            }
        });
        tbody2.appendChild(tr);

        // 생성된 헤더와 본문을 두 번째 테이블에 추가
        table2.appendChild(thead2);
        table2.appendChild(tbody2);

        $("#" + group).append(table2);
    });
                                $("#loginModal").hide();
                                $("#userData").show();
                            });
                        } else {
                            alert("로그인 실패");
                        }
                    }
                });
            });
        });
    </script>
</body>
</html>
